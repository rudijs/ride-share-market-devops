require 'json'
require 'base64'
require 'digest/sha2'
require 'openssl'

encrypted_data = "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\n5Rwz1b3QxhieS4o=\n"

encrypted_bytes = Base64.decode64(encrypted_data)

d = OpenSSL::Cipher::Cipher.new('aes-256-cbc')
d.decrypt
d.key = Digest::SHA256.digest('s{=+j>@`;o]!D/N6R3?i[dQ1/')
d.iv = Base64.decode64("92cYLpYf688bqpXOFoGH1A==\n")

plaintext = d.update(encrypted_bytes)
plaintext << d.final

# puts plaintext

secrets = JSON.parse(plaintext)

puts secrets["json_wrapper"]["varnish"]
